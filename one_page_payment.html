<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI é©—è­‰ä»˜æ¬¾ç³»çµ±</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Microsoft JhengHei', 'Segoe UI', Roboto, sans-serif;
            background: #f5f7fa;
            min-height: 100vh;
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 20px;
        }

        .container {
            background: white;
            border-radius: 8px;
            box-shadow: 0 2px 12px rgba(0,0,0,0.1);
            max-width: 520px;
            width: 100%;
            overflow: hidden;
        }

        .header {
            background: linear-gradient(135deg, #1d6fa5 0%, #165a87 100%);
            color: white;
            padding: 28px 30px;
            text-align: center;
        }

        .header h1 {
            font-size: 22px;
            margin-bottom: 8px;
            font-weight: 600;
        }

        .header p {
            opacity: 0.95;
            font-size: 14px;
            font-weight: 400;
        }

        .content {
            padding: 30px;
        }

        .verification-section, .payment-section {
            display: none;
        }

        .verification-section.active, .payment-section.active {
            display: block;
        }

        .attempts-counter {
            background: #fffbf0;
            border: 1px solid #ffc107;
            color: #856404;
            padding: 14px;
            border-radius: 6px;
            margin-bottom: 20px;
            text-align: center;
            font-size: 14px;
            font-weight: 500;
        }

        .attempts-counter.danger {
            background: #fff5f5;
            border-color: #ff6b6b;
            color: #c92a2a;
        }

        .question-box {
            background: #fafbfc;
            padding: 22px;
            border-radius: 8px;
            margin-bottom: 20px;
            border: 1px solid #e9ecef;
        }

        .question-box h3 {
            color: #333;
            margin-bottom: 16px;
            font-size: 15px;
            font-weight: 600;
        }

        .image-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 12px;
            margin-top: 15px;
        }

        .image-option {
            aspect-ratio: 1;
            border: 2px solid #dee2e6;
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 48px;
            background: white;
        }

        .image-option:hover {
            border-color: #1d6fa5;
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(29, 111, 165, 0.15);
        }

        .image-option.selected {
            border-color: #1d6fa5;
            background: #f0f7fc;
            box-shadow: 0 0 0 3px rgba(29, 111, 165, 0.1);
        }

        .text-input {
            width: 100%;
            padding: 14px;
            border: 1px solid #dee2e6;
            border-radius: 6px;
            font-size: 15px;
            transition: all 0.2s;
        }

        .text-input:focus {
            outline: none;
            border-color: #1d6fa5;
            box-shadow: 0 0 0 3px rgba(29, 111, 165, 0.1);
        }

        .btn {
            width: 100%;
            padding: 14px;
            border: none;
            border-radius: 6px;
            font-size: 15px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
            margin-top: 15px;
        }

        .btn-primary {
            background: #1d6fa5;
            color: white;
        }

        .btn-primary:hover {
            background: #165a87;
            box-shadow: 0 4px 12px rgba(29, 111, 165, 0.25);
        }

        .btn-primary:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .btn-secondary {
            background: #868e96;
            color: white;
        }

        .btn-secondary:hover {
            background: #6c757d;
            box-shadow: 0 4px 12px rgba(108, 117, 125, 0.25);
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            color: #495057;
            font-weight: 500;
            font-size: 14px;
        }

        .form-group input {
            width: 100%;
            padding: 12px 14px;
            border: 1px solid #dee2e6;
            border-radius: 6px;
            font-size: 14px;
            transition: all 0.2s;
        }

        .form-group input:focus {
            outline: none;
            border-color: #1d6fa5;
            box-shadow: 0 0 0 3px rgba(29, 111, 165, 0.1);
        }

        .form-group input:read-only {
            background-color: #f8f9fa;
            color: #6c757d;
        }

        .success-message {
            background: #d4edda;
            border: 1px solid #c3e6cb;
            color: #155724;
            padding: 14px;
            border-radius: 6px;
            margin-bottom: 20px;
            text-align: center;
            font-size: 14px;
        }

        .error-message {
            background: #fff5f5;
            border: 1px solid #ff6b6b;
            color: #c92a2a;
            padding: 14px;
            border-radius: 6px;
            margin-bottom: 20px;
            text-align: center;
            font-size: 14px;
            animation: shake 0.5s;
        }

        .blocked-message {
            text-align: center;
            padding: 40px 20px;
        }

        .blocked-message .icon {
            font-size: 64px;
            margin-bottom: 20px;
        }

        .blocked-message h2 {
            color: #dc3545;
            margin-bottom: 10px;
            font-weight: 600;
        }

        .blocked-message p {
            color: #6c757d;
        }

        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            25% { transform: translateX(-8px); }
            75% { transform: translateX(8px); }
        }

        .card-logos {
            display: flex;
            gap: 8px;
            margin-top: 10px;
        }

        .card-logo {
            font-size: 11px;
            padding: 4px 10px;
            background: #f1f3f5;
            border-radius: 4px;
            color: #6c757d;
            font-weight: 500;
        }

        /* ä»˜æ¬¾å€’æ•¸è¨ˆæ™‚ */
        .payment-timer {
            background: #fff9e6;
            border: 1px solid #ffb700;
            color: #996a00;
            padding: 14px;
            border-radius: 6px;
            margin-bottom: 20px;
            text-align: center;
            font-size: 14px;
            font-weight: 500;
        }

        .payment-timer.warning {
            background: #fff5f5;
            border-color: #ff6b6b;
            color: #c92a2a;
            animation: pulse 1.5s infinite;
        }

        .timer-display {
            font-size: 20px;
            font-weight: 700;
            margin: 0 4px;
            font-family: 'Courier New', monospace;
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.85; }
        }

        .payment-expired {
            text-align: center;
            padding: 40px 20px;
        }

        .payment-expired .icon {
            font-size: 64px;
            margin-bottom: 20px;
        }

        .payment-expired h2 {
            color: #dc3545;
            margin-bottom: 10px;
            font-weight: 600;
        }

        .payment-expired p {
            color: #6c757d;
            margin-bottom: 20px;
        }

        /* 3DS é©—è­‰æ¨£å¼ */
        .tds-container {
            max-width: 460px;
            margin: 0 auto;
        }

        .tds-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 18px 20px;
            background: linear-gradient(135deg, #1d6fa5 0%, #165a87 100%);
            color: white;
            border-radius: 6px 6px 0 0;
            margin: -30px -30px 0 -30px;
        }

        .tds-header img {
            height: 22px;
        }

        .tds-lock {
            font-size: 18px;
        }

        .tds-content {
            padding: 20px 0;
        }

        .tds-info {
            text-align: center;
            margin-bottom: 24px;
        }

        .tds-info h3 {
            color: #212529;
            margin-bottom: 8px;
            font-size: 18px;
            font-weight: 600;
        }

        .tds-info p {
            color: #6c757d;
            font-size: 14px;
        }

        .tds-transaction {
            background: #fafbfc;
            border-radius: 6px;
            padding: 16px;
            margin-bottom: 20px;
            border: 1px solid #e9ecef;
        }

        .tds-row {
            display: flex;
            justify-content: space-between;
            padding: 10px 0;
            border-bottom: 1px solid #e9ecef;
        }

        .tds-row:last-child {
            border-bottom: none;
        }

        .tds-row span {
            color: #6c757d;
            font-size: 13px;
        }

        .tds-row strong {
            color: #212529;
            font-size: 13px;
            font-weight: 600;
        }

        .tds-verify-box {
            background: white;
            border: 1px solid #e9ecef;
            border-radius: 6px;
            padding: 20px;
            margin-bottom: 20px;
        }

        .tds-sms-info {
            text-align: center;
            color: #28a745;
            font-weight: 500;
            margin-bottom: 6px;
            font-size: 14px;
        }

        .tds-phone {
            text-align: center;
            color: #6c757d;
            font-size: 13px;
            margin-bottom: 20px;
        }

        .tds-input {
            width: 100%;
            padding: 14px;
            border: 1px solid #dee2e6;
            border-radius: 6px;
            font-size: 22px;
            text-align: center;
            letter-spacing: 6px;
            font-weight: 600;
            transition: all 0.2s;
        }

        .tds-input:focus {
            outline: none;
            border-color: #1d6fa5;
            box-shadow: 0 0 0 3px rgba(29, 111, 165, 0.1);
        }

        .tds-timer {
            text-align: center;
            margin: 16px 0;
            padding: 12px;
            background: #fff9e6;
            border-radius: 6px;
            font-size: 13px;
            color: #996a00;
            border: 1px solid #ffe066;
        }

        .tds-timer span {
            font-weight: 600;
            font-size: 15px;
        }

        .tds-help {
            text-align: center;
            margin-top: 16px;
            font-size: 13px;
        }

        .tds-help a {
            color: #1d6fa5;
            text-decoration: none;
            font-weight: 500;
        }

        .tds-help a:hover {
            text-decoration: underline;
        }

        .tds-footer {
            text-align: center;
            padding: 16px;
            background: #fafbfc;
            border-radius: 6px;
            font-size: 12px;
            color: #6c757d;
            border: 1px solid #e9ecef;
        }

        /* è¼‰å…¥å‹•ç•« */
        .loading-animation {
            text-align: center;
            padding: 60px 20px;
        }

        .spinner {
            width: 50px;
            height: 50px;
            border: 4px solid #f1f3f5;
            border-top: 4px solid #1d6fa5;
            border-radius: 50%;
            margin: 0 auto 20px;
            animation: spin 0.8s linear infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .loading-animation h3 {
            color: #212529;
            margin-bottom: 10px;
            font-weight: 600;
        }

        .loading-animation p {
            color: #6c757d;
            font-size: 14px;
        }

        /* æˆåŠŸå‹•ç•« */
        .success-animation {
            text-align: center;
            padding: 40px 20px;
        }

        .checkmark {
            width: 70px;
            height: 70px;
            border-radius: 50%;
            background: #28a745;
            color: white;
            font-size: 42px;
            line-height: 70px;
            margin: 0 auto 20px;
            animation: scaleIn 0.4s ease-out;
        }

        @keyframes scaleIn {
            0% { transform: scale(0); }
            50% { transform: scale(1.08); }
            100% { transform: scale(1); }
        }

        .success-animation h2 {
            color: #28a745;
            margin-bottom: 10px;
            font-weight: 600;
        }

        .success-animation p {
            color: #6c757d;
            margin-bottom: 28px;
            font-size: 14px;
        }

        .receipt {
            background: #fafbfc;
            border-radius: 6px;
            padding: 20px;
            margin-bottom: 20px;
            text-align: left;
            border: 1px solid #e9ecef;
        }

        .receipt-row {
            display: flex;
            justify-content: space-between;
            padding: 12px 0;
            border-bottom: 1px solid #e9ecef;
        }

        .receipt-row:last-child {
            border-bottom: none;
        }

        .receipt-row span {
            color: #6c757d;
            font-size: 13px;
        }

        .receipt-row strong {
            color: #212529;
            font-size: 13px;
            font-weight: 600;
        }

        /* éŒ¯èª¤å‹•ç•« */
        .error-animation {
            text-align: center;
            padding: 40px 20px;
        }

        .error-icon {
            width: 70px;
            height: 70px;
            border-radius: 50%;
            background: #dc3545;
            color: white;
            font-size: 42px;
            line-height: 70px;
            margin: 0 auto 20px;
        }

        .error-animation h2 {
            color: #dc3545;
            margin-bottom: 10px;
            font-weight: 600;
        }

        .error-animation p {
            color: #6c757d;
            margin-bottom: 28px;
            font-size: 14px;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ğŸ›’ å®‰å…¨çµå¸³ç³»çµ±</h1>
            <p>è«‹å…ˆå®Œæˆ AI èº«ä»½é©—è­‰ä»¥ç¹¼çºŒä»˜æ¬¾</p>
        </div>

        <div class="content">
            <!-- é©—è­‰å€åŸŸ -->
            <div class="verification-section active" id="verificationSection">
                <div class="attempts-counter" id="attemptsCounter">
                    å‰©é¤˜é©—è­‰æ¬¡æ•¸ï¼š<strong>5/5</strong>
                </div>

                <div id="errorMessage"></div>

                <div class="question-box" id="questionBox">
                    <h3 id="questionText">æ­£åœ¨è¼‰å…¥é©—è­‰...</h3>
                    <div id="challengeArea"></div>
                </div>

                <button class="btn btn-primary" id="verifyBtn" onclick="checkAnswer()">
                    é€å‡ºé©—è­‰
                </button>
            </div>

            <!-- ä»˜æ¬¾å€åŸŸ -->
            <div class="payment-section" id="paymentSection">
                <div class="success-message">
                    âœ… é©—è­‰æˆåŠŸï¼æ‚¨å¯ä»¥å®‰å…¨åœ°å®Œæˆä»˜æ¬¾
                </div>

                <div class="payment-timer" id="paymentTimer">
                    â±ï¸ è«‹åœ¨ <span id="paymentCountdown" class="timer-display">2:00</span> å…§å®Œæˆä»˜æ¬¾
                </div>

                <form id="paymentForm" onsubmit="return handlePayment(event)">
                    <div class="form-group">
                        <label>å•†å“åç¨±</label>
                        <input type="text" value="ç²¾é¸èª²ç¨‹æ–¹æ¡ˆ" readonly>
                    </div>

                    <div class="form-group">
                        <label>ä»˜æ¬¾é‡‘é¡</label>
                        <input type="text" value="NT$ 1,999" readonly>
                    </div>

                    <div class="form-group">
                        <label>æŒå¡äººå§“å *</label>
                        <input type="text" required placeholder="è«‹è¼¸å…¥æŒå¡äººå§“å" id="cardHolder">
                    </div>

                    <div class="form-group">
                        <label>ä¿¡ç”¨å¡è™Ÿ *</label>
                        <input type="text" required placeholder="1234 5678 9012 3456" maxlength="19" id="cardNumber">
                        <div class="card-logos">
                            <span class="card-logo">VISA</span>
                            <span class="card-logo">MasterCard</span>
                            <span class="card-logo">JCB</span>
                        </div>
                    </div>

                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 15px;">
                        <div class="form-group">
                            <label>æœ‰æ•ˆæœŸé™ *</label>
                            <input type="text" required placeholder="MM/YY" maxlength="5" id="cardExpiry">
                        </div>
                        <div class="form-group">
                            <label>å®‰å…¨ç¢¼ *</label>
                            <input type="text" required placeholder="CVV" maxlength="3" id="cardCVV">
                        </div>
                    </div>

                    <button type="submit" class="btn btn-primary">
                        ğŸ’³ ç¢ºèªä»˜æ¬¾ NT$ 1,999
                    </button>
                </form>
            </div>

            <!-- å°é–å€åŸŸ -->
            <div class="verification-section" id="blockedSection">
                <div class="blocked-message">
                    <div class="icon">ğŸš«</div>
                    <h2>é©—è­‰å¤±æ•—æ¬¡æ•¸éå¤š</h2>
                    <p>ç‚ºäº†ä¿è­·äº¤æ˜“å®‰å…¨ï¼Œæ­¤é é¢å·²è¢«æš«æ™‚é–å®š</p>
                    <p style="margin-top: 10px; font-size: 13px; color: #adb5bd;">
                        è«‹ç¨å¾Œå†è©¦æˆ–è¯ç¹«å®¢æœäººå“¡
                    </p>
                </div>
            </div>
        </div>
    </div>

    <script>
        let attempts = 5;
        let currentChallenge = null;
        let selectedImages = [];

        const challenges = {
            image: [
                {
                    question: "è«‹é¸å‡ºæ‰€æœ‰ã€Œæ°´æœã€",
                    options: ["ğŸ", "ğŸ•", "ğŸŒ", "ğŸš—", "ğŸ‡", "ğŸ ", "ğŸŠ", "âš½", "ğŸ‰"],
                    correct: ["ğŸ", "ğŸŒ", "ğŸ‡", "ğŸŠ", "ğŸ‰"]
                },
                {
                    question: "è«‹é¸å‡ºæ‰€æœ‰ã€Œå‹•ç‰©ã€",
                    options: ["ğŸ¶", "ğŸŒ³", "ğŸ±", "ğŸ€", "ğŸ¼", "ğŸ®", "ğŸ¦", "ğŸ“±", "ğŸ¯"],
                    correct: ["ğŸ¶", "ğŸ±", "ğŸ¼", "ğŸ¦", "ğŸ¯"]
                },
                {
                    question: "è«‹é¸å‡ºæ‰€æœ‰ã€Œäº¤é€šå·¥å…·ã€",
                    options: ["ğŸš—", "ğŸ”", "âœˆï¸", "ğŸŒ¸", "ğŸš‚", "ğŸ’»", "ğŸš¢", "ğŸ¨", "ğŸš"],
                    correct: ["ğŸš—", "âœˆï¸", "ğŸš‚", "ğŸš¢", "ğŸš"]
                }
            ],
            text: [
                { question: "3 + 7 ç­‰æ–¼å¤šå°‘ï¼Ÿ", answer: "10" },
                { question: "ä¸€å‘¨æœ‰å¹¾å¤©ï¼Ÿ", answer: "7" },
                { question: "è«‹è¼¸å…¥ã€Œé©—è­‰ã€é€™å…©å€‹å­—", answer: "é©—è­‰" },
                { question: "10 - 4 ç­‰æ–¼å¤šå°‘ï¼Ÿ", answer: "6" },
                { question: "å°ç£çš„é¦–éƒ½æ˜¯ï¼Ÿ", answer: "å°åŒ—" },
                { question: "ä¸€å¹´æœ‰å¹¾å€‹æœˆï¼Ÿ", answer: "12" }
            ]
        };

        function loadChallenge() {
            const type = Math.random() > 0.5 ? 'image' : 'text';
            
            if (type === 'image') {
                const challenge = challenges.image[Math.floor(Math.random() * challenges.image.length)];
                currentChallenge = { type: 'image', data: challenge };
                
                document.getElementById('questionText').textContent = challenge.question;
                
                const grid = document.createElement('div');
                grid.className = 'image-grid';
                
                challenge.options.forEach(emoji => {
                    const div = document.createElement('div');
                    div.className = 'image-option';
                    div.textContent = emoji;
                    div.onclick = () => toggleImage(div, emoji);
                    grid.appendChild(div);
                });
                
                document.getElementById('challengeArea').innerHTML = '';
                document.getElementById('challengeArea').appendChild(grid);
                selectedImages = [];
            } else {
                const challenge = challenges.text[Math.floor(Math.random() * challenges.text.length)];
                currentChallenge = { type: 'text', data: challenge };
                
                document.getElementById('questionText').textContent = challenge.question;
                
                const input = document.createElement('input');
                input.type = 'text';
                input.className = 'text-input';
                input.id = 'answerInput';
                input.placeholder = 'è«‹è¼¸å…¥ç­”æ¡ˆ';
                
                document.getElementById('challengeArea').innerHTML = '';
                document.getElementById('challengeArea').appendChild(input);
            }
        }

        function toggleImage(element, emoji) {
            element.classList.toggle('selected');
            const index = selectedImages.indexOf(emoji);
            if (index > -1) {
                selectedImages.splice(index, 1);
            } else {
                selectedImages.push(emoji);
            }
        }

        function checkAnswer() {
            let isCorrect = false;

            if (currentChallenge.type === 'image') {
                const correct = currentChallenge.data.correct.sort();
                const selected = selectedImages.sort();
                isCorrect = JSON.stringify(correct) === JSON.stringify(selected);
            } else {
                const userAnswer = document.getElementById('answerInput').value.trim();
                isCorrect = userAnswer === currentChallenge.data.answer;
            }

            if (isCorrect) {
                showPaymentSection();
            } else {
                attempts--;
                updateAttemptsCounter();
                
                if (attempts <= 0) {
                    showBlockedSection();
                } else {
                    showError('âŒ é©—è­‰å¤±æ•—ï¼Œè«‹é‡è©¦');
                    loadChallenge();
                }
            }
        }

        function updateAttemptsCounter() {
            const counter = document.getElementById('attemptsCounter');
            counter.innerHTML = `å‰©é¤˜é©—è­‰æ¬¡æ•¸ï¼š<strong>${attempts}/5</strong>`;
            if (attempts <= 2) {
                counter.classList.add('danger');
            }
        }

        function showError(message) {
            const errorDiv = document.getElementById('errorMessage');
            errorDiv.innerHTML = `<div class="error-message">${message}</div>`;
            setTimeout(() => {
                errorDiv.innerHTML = '';
            }, 3000);
        }

        function showPaymentSection() {
            document.getElementById('verificationSection').classList.remove('active');
            document.getElementById('paymentSection').classList.add('active');
            startPaymentTimer();
        }

        function showBlockedSection() {
            document.getElementById('verificationSection').classList.remove('active');
            document.getElementById('blockedSection').classList.add('active');
        }

        let paymentTimerInterval;
        function startPaymentTimer() {
            let timeLeft = 120;
            const timerDisplay = document.getElementById('paymentCountdown');
            const timerBox = document.getElementById('paymentTimer');
            
            paymentTimerInterval = setInterval(() => {
                timeLeft--;
                
                const minutes = Math.floor(timeLeft / 60);
                const seconds = timeLeft % 60;
                timerDisplay.textContent = `${minutes}:${seconds.toString().padStart(2, '0')}`;
                
                if (timeLeft <= 30) {
                    timerBox.classList.add('warning');
                }
                
                if (timeLeft <= 0) {
                    clearInterval(paymentTimerInterval);
                    showPaymentExpired();
                }
            }, 1000);
        }

        function showPaymentExpired() {
            const paymentSection = document.getElementById('paymentSection');
            paymentSection.innerHTML = `
                <div class="payment-expired">
                    <div class="icon">â°</div>
                    <h2>ä»˜æ¬¾æ™‚é–“å·²é€¾æœŸ</h2>
                    <p>ç‚ºäº†ä¿è­·æ‚¨çš„äº¤æ˜“å®‰å…¨ï¼Œä»˜æ¬¾é é¢å·²éæœŸ</p>
                    <p style="font-size: 13px; color: #adb5bd;">
                        è«‹é‡æ–°é€²è¡Œé©—è­‰ä»¥ç¹¼çºŒä»˜æ¬¾
                    </p>
                    <button class="btn btn-primary" onclick="location.reload()">
                        é‡æ–°é–‹å§‹
                    </button>
                </div>
            `;
        }

        function handlePayment(event) {
            event.preventDefault();
            
            // å–å¾—ä¿¡ç”¨å¡è³‡è¨Šï¼ˆç”¨æ–¼ 3DS é¡¯ç¤ºï¼‰
            const cardNumber = document.getElementById('cardNumber').value;
            const last4Digits = cardNumber.slice(-4) || '3456';
            
            clearInterval(paymentTimerInterval);
            show3DSVerification(last4Digits);
            return false;
        }

        function show3DSVerification(last4 = '3456') {
            const paymentSection = document.getElementById('paymentSection');
            paymentSection.innerHTML = `
                <div class="tds-container">
                    <div class="tds-header">
                        <div style="color: white; font-weight: 600; font-size: 15px;">ğŸ”’ Visa Secure</div>
                        <div class="tds-lock">ğŸ›¡ï¸</div>
                    </div>
                    
                    <div class="tds-content">
                        <div class="tds-info">
                            <h3>é¡å¤–å®‰å…¨é©—è­‰</h3>
                            <p>æ‚¨çš„ç™¼å¡éŠ€è¡Œéœ€è¦é©—è­‰æ­¤ç­†äº¤æ˜“</p>
                        </div>

                        <div class="tds-transaction">
                            <div class="tds-row">
                                <span>å•†å®¶åç¨±</span>
                                <strong>ç²¾é¸ç·šä¸Šå•†åŸ</strong>
                            </div>
                            <div class="tds-row">
                                <span>äº¤æ˜“é‡‘é¡</span>
                                <strong>NT$ 1,999</strong>
                            </div>
                            <div class="tds-row">
                                <span>ä¿¡ç”¨å¡è™Ÿ</span>
                                <strong>**** **** **** ${last4}</strong>
                            </div>
                            <div class="tds-row">
                                <span>äº¤æ˜“æ—¥æœŸ</span>
                                <strong>${new Date().toLocaleDateString('zh-TW')}</strong>
                            </div>
                        </div>

                        <div class="tds-verify-box">
                            <p class="tds-sms-info">ğŸ“± é©—è­‰ç¢¼å·²ç™¼é€è‡³æ‚¨çš„æ‰‹æ©Ÿ</p>
                            <p class="tds-phone">09** *** 678</p>
                            
                            <div class="form-group">
                                <label>è«‹è¼¸å…¥ 6 ä½æ•¸é©—è­‰ç¢¼</label>
                                <input type="text" 
                                       id="tdsCode" 
                                       class="tds-input" 
                                       maxlength="6" 
                                       placeholder="000000"
                                       oninput="this.value = this.value.replace(/[^0-9]/g, '')">
                            </div>

                            <div class="tds-timer" id="tdsTimer">
                                â±ï¸ é©—è­‰ç¢¼æœ‰æ•ˆæ™‚é–“ï¼š<span id="countdown">180</span> ç§’
                            </div>

                            <button class="btn btn-primary" onclick="verify3DS()">
                                ç¢ºèªé©—è­‰
                            </button>

                            <button class="btn btn-secondary" onclick="cancel3DS()">
                                å–æ¶ˆäº¤æ˜“
                            </button>

                            <p class="tds-help">
                                <small>æ¸¬è©¦æç¤ºï¼šè¼¸å…¥ <strong>111111</strong> é©—è­‰æˆåŠŸ / <strong>000000</strong> é©—è­‰å¤±æ•—</small>
                            </p>
                        </div>

                        <div class="tds-footer">
                            <p>ğŸ›¡ï¸ æ­¤é©—è­‰ç”±æ‚¨çš„ç™¼å¡éŠ€è¡Œæä¾›ï¼Œä¿è­·æ‚¨çš„äº¤æ˜“å®‰å…¨</p>
                        </div>
                    </div>
                </div>
            `;

            startCountdown();
        }

        let countdownInterval;
        function startCountdown() {
            let timeLeft = 180;
            const countdownElement = document.getElementById('countdown');
            
            countdownInterval = setInterval(() => {
                timeLeft--;
                countdownElement.textContent = timeLeft;
                
                if (timeLeft <= 30) {
                    countdownElement.style.color = '#dc3545';
                }
                
                if (timeLeft <= 0) {
                    clearInterval(countdownInterval);
                    show3DSTimeout();
                }
            }, 1000);
        }

        function verify3DS() {
            const code = document.getElementById('tdsCode').value;
            
            if (code.length !== 6) {
                alert('è«‹è¼¸å…¥ 6 ä½æ•¸é©—è­‰ç¢¼');
                return;
            }

            clearInterval(countdownInterval);
            
            // é¡¯ç¤ºé©—è­‰ä¸­ç•«é¢
            document.getElementById('paymentSection').innerHTML = `
                <div class="tds-container">
                    <div class="loading-animation">
                        <div class="spinner"></div>
                        <h3>é©—è­‰ä¸­...</h3>
                        <p>è«‹ç¨å€™ï¼Œæ­£åœ¨ç¢ºèªæ‚¨çš„èº«ä»½</p>
                    </div>
                </div>
            `;

            // æ¨¡æ“¬é©—è­‰è™•ç†
            setTimeout(() => {
                if (code === '111111') {
                    // é©—è­‰æˆåŠŸ
                    show3DSSuccess();
                } else if (code === '000000') {
                    // é©—è­‰å¤±æ•—
                    show3DSFailed();
                } else {
                    // å…¶ä»–é©—è­‰ç¢¼è¦–ç‚ºéŒ¯èª¤
                    show3DSError();
                }
            }, 2000);
        }

        function show3DSFailed() {
            document.getElementById('paymentSection').innerHTML = `
                <div class="tds-container">
                    <div class="error-animation">
                        <div class="error-icon">âŒ</div>
                        <h2>é©—è­‰å¤±æ•—</h2>
                        <p>é©—è­‰ç¢¼éŒ¯èª¤ï¼Œè«‹ç¢ºèªå¾Œé‡è©¦</p>
                        
                        <button class="btn btn-primary" onclick="show3DSVerification()">
                            é‡æ–°é©—è­‰
                        </button>
                        
                        <button class="btn btn-secondary" onclick="location.reload()">
                            è¿”å›é¦–é 
                        </button>
                    </div>
                </div>
            `;
        }

        function show3DSError() {
            document.getElementById('paymentSection').innerHTML = `
                <div class="tds-container">
                    <div class="error-animation">
                        <div class="error-icon">âš ï¸</div>
                        <h2>é©—è­‰ç¢¼ä¸æ­£ç¢º</h2>
                        <p>è«‹è¼¸å…¥æ­£ç¢ºçš„ 6 ä½æ•¸é©—è­‰ç¢¼</p>
                        <p style="font-size: 13px; color: #adb5bd; margin-top: 10px;">
                            æç¤ºï¼šè«‹è¼¸å…¥ 111111 æˆ– 000000
                        </p>
                        
                        <button class="btn btn-primary" onclick="show3DSVerification()">
                            é‡æ–°é©—è­‰
                        </button>
                        
                        <button class="btn btn-secondary" onclick="location.reload()">
                            è¿”å›é¦–é 
                        </button>
                    </div>
                </div>
            `;
        }

        function show3DSSuccess() {
            document.getElementById('paymentSection').innerHTML = `
                <div class="tds-container">
                    <div class="success-animation">
                        <div class="checkmark">âœ“</div>
                        <h2>ä»˜æ¬¾æˆåŠŸï¼</h2>
                        <p>æ‚¨çš„äº¤æ˜“å·²å®Œæˆ</p>
                        
                        <div class="receipt">
                            <div class="receipt-row">
                                <span>è¨‚å–®ç·¨è™Ÿ</span>
                                <strong>#${Math.random().toString(36).substr(2, 9).toUpperCase()}</strong>
                            </div>
                            <div class="receipt-row">
                                <span>ä»˜æ¬¾é‡‘é¡</span>
                                <strong>NT$ 1,999</strong>
                            </div>
                            <div class="receipt-row">
                                <span>ä»˜æ¬¾æ™‚é–“</span>
                                <strong>${new Date().toLocaleString('zh-TW')}</strong>
                            </div>
                            <div class="receipt-row">
                                <span>ä»˜æ¬¾æ–¹å¼</span>
                                <strong>ä¿¡ç”¨å¡ (**** 3456)</strong>
                            </div>
                        </div>

                        <button class="btn btn-primary" onclick="window.print()">
                            ğŸ“„ åˆ—å°æ”¶æ“š
                        </button>
                    </div>
                </div>
            `;
        }

        function show3DSTimeout() {
            document.getElementById('paymentSection').innerHTML = `
                <div class="tds-container">
                    <div class="error-animation">
                        <div class="error-icon">â°</div>
                        <h2>é©—è­‰é€¾æ™‚</h2>
                        <p>é©—è­‰ç¢¼å·²éæœŸï¼Œè«‹é‡æ–°ç™¼é€</p>
                        
                        <button class="btn btn-primary" onclick="show3DSVerification()">
                            é‡æ–°é©—è­‰
                        </button>
                        
                        <button class="btn btn-secondary" onclick="location.reload()">
                            è¿”å›é¦–é 
                        </button>
                    </div>
                </div>
            `;
        }

        function cancel3DS() {
            clearInterval(countdownInterval);
            if (confirm('ç¢ºå®šè¦å–æ¶ˆæ­¤ç­†äº¤æ˜“å—ï¼Ÿ')) {
                clearInterval(paymentTimerInterval);
                document.getElementById('paymentSection').innerHTML = `
                    <div class="tds-container">
                        <div class="error-animation">
                            <div class="error-icon">âŒ</div>
                            <h2>äº¤æ˜“å·²å–æ¶ˆ</h2>
                            <p>æ‚¨å¯ä»¥é‡æ–°å˜—è©¦ä»˜æ¬¾</p>
                            
                            <button class="btn btn-primary" onclick="location.reload()">
                                è¿”å›é¦–é 
                            </button>
                        </div>
                    </div>
                `;
            }
        }

        function resend3DS() {
            alert('âœ… é©—è­‰ç¢¼å·²é‡æ–°ç™¼é€ï¼\n\nï¼ˆé€™æ˜¯ç¤ºç¯„åŠŸèƒ½ï¼‰');
            clearInterval(countdownInterval);
            startCountdown();
        }

        loadChallenge();
    </script>
</body>
</html>